input {
  # Filebeat에서 받는 로그
  beats {
    port => 5044
  }
  
  # TCP를 통한 로그 수신
  tcp {
    port => 5000
    codec => json
  }
  
  # UDP를 통한 로그 수신
  udp {
    port => 5000
    codec => json
  }
}

filter {
  # JSON 로그 파싱
  if [type] == "spring-boot" {
    json {
      source => "message"
    }
    
    # 로그 레벨에 따른 태그 추가
    if [level] == "ERROR" {
      mutate {
        add_tag => ["error"]
      }
    }
    
    if [level] == "WARN" {
      mutate {
        add_tag => ["warning"]
      }
    }
    
    if [level] == "INFO" {
      mutate {
        add_tag => ["info"]
      }
    }
    
    # 타임스탬프 파싱
    date {
      match => ["timestamp", "ISO8601"]
      target => "@timestamp"
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "knittda-logs-%{+YYYY.MM.dd}"
    document_type => "log"
  }
  
  # 프로덕션에서는 stdout 제거
  # stdout {
  #   codec => rubydebug
  # }
} 